<!doctype html>
<html lang="en" thanks="Xteye">
<head>
    <!-- Compiled and minified JQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

    <!-- Compiled and minified Moment Timezone -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.14/moment-timezone-with-data.min.js"></script>

    <!-- DataTables w/ bootstrap -->
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.16/api/page.jumpToData().js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.min.css">

    <!-- Compiled and minified bootstrap w/ optionnal theme-->
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">

    <!-- Custom CSS and JS -->
    <script type="text/javascript">window.bypass_update_restrictions = {{ bypass_update_restrictions }}</script>
    <link rel="stylesheet" href="/assets/css/custom.css">
    <script type="text/javascript" src="/assets/js/scoreboard-datatable.js"></script>

    <link rel="icon" href="/assets/images/favicon.ico">
    <title>Ava's speedrun.com global scoreboard</title>
</head>
<body>
    {% include "loginModal.html" %}
    {% include "navbar.html" %}

    <div class="container">
        <div class="alert alert-info" id="breaking-news">
          <script>window.newLink = window.location.href.replace('5000', '3000') + 'global-scoreboard'</script>
          A new beta version of this scoreboard, entirely rewriten in React and TypeScript using Bootstrap 4 is available over at
          <b>
            <a
              href="/global-scoreboard"
              onclick="location.href=window.newLink;return false;"
            ><script>document.write(window.newLink)</script></a>.
          </b>
          <br>
          It has about the same look and feel, but is a lot more reactive, fluid and will be seeing more updates.
        </div>
        <div class="alert alert-info" id="ajaxResponseMessage">Building the DataTable. Please wait...</div>

        <div class="col-md-4 ">
            <div class="row">
                <form method="POST" class="ajax" id="update-user-form">
                    <div class="form-group">
                        <input type="hidden" id="action" name="action" value="update-user">
                        <label for="name-or-id"> Update runner:</label>
                        <div class="input-group">
                            <input type="text"
                                   class="form-control"
                                   id="name-or-id"
                                   name="name-or-id"
                                   required
                                   {% if not current_user.is_authenticated %}
                                   placeholder="Please log in first"
                                   disabled
                                   {% else %}
                                   placeholder="Name or ID"
                                   {% endif %}>
                            <span class="input-group-btn">
                                <button id="update-runner-button"
                                        type="button"
                                        class="btn btn-primary"
                                        {% if not current_user.is_authenticated %}disabled{% endif %}>
                                    Submit
                                </button>
                            </span>
                        </div>
                    </div>
                </form>
            </div>

            <div class="row">
                <label for="preview">Quick view:</label>
                <table class="table" id="preview">
                    <tbody>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th colspan="2">Score</th>
                        </tr>
                        <tr class="highlight-current-user" id="preview-{{ current_user.user_id }}">
                            {% if current_user.is_authenticated %}
                            <td>???</td>
                            <td><a href="https://speedrun.com/user/{{ current_user.name }}" target="_blank">{{ current_user.name }}</a></td>
                            <td>{{ current_user.score }}</td>
                            <td><a href="javascript:jumpToPlayer('{{ current_user.user_id }}');"><span class="pull-right glyphicon glyphicon-circle-arrow-right"></span></a></td>
                            {% else %}
                            <td colspan="4"></td>
                            {% endif %}
                        </tr>
                        {% if current_user.is_authenticated %}
                            <script>window.friends = {};</script>
                            {% for friend_id in friends %}
                            <script>window.friends["{{ friend_id }}"] = true;</script>
                            <tr class="highlight-friend" id="preview-{{ friend_id }}">
                                <td>[???]</td>
                                <td>[{{ friend_id }}]<span class="pull-right friend-icon" onClick="javascript:unfriend('{{ friend_id }}');"></span></td>
                                <td>[???]</td>
                                <td><a href="javascript:jumpToPlayer('{{ friend_id }}');"><span class="pull-right glyphicon glyphicon-circle-arrow-right"></span></a></td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr class="highlight-friend"><td colspan="4"></td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>


        <div class="col-md-8">
            <div class="col-xs-12"><label for="preview">Scoreboard:</label></div>
            <table class="table table-bordered table-striped" id="scoreboard" style="display:none;">
                <thead>
                    <tr>
                        <th class="col-xs-1">Rank</th>
                        <th class="col-xs-6">Name</th>
                        <th class="col-xs-1">Score</th>
                        <th class="col-xs-3">Last Updated</th>
                        <th class="col-xs-1">ID</th>
                    </tr>
                </thead>
                <tbody>
                {#
                {% for player in players %}
                    {% set colorclass = "" %}
                    {% if player.user_id == current_user.user_id %}
                        {% set colorclass = colorclass + " highlight-current-user" %}
                    {% elif player.user_id in friends %}
                        {% set colorclass = colorclass + " highlight-friend" %}
                    {% elif player.user_id == "kjp4y75j" %}
                        {% set colorclass = colorclass + " highlight-vip" %}
                    {% endif %}
                    <tr class="{{ colorclass }}" name="{{ player.name }}" id="{{ player.user_id }}">
                        <td>{{ player.rank }}</td>
                        <td id="{{ player.name }}">
                            <a href="https://www.speedrun.com/user/{{ player.name }}" target="_blank">{{ player.name }}</a>
                            {% if current_user.is_authenticated %}
                                <span
                                    class="pull-right friend-icon"
                                    onClick="javascript:{% if player.user_id in friends %}unfriend{% else %}befriend{% endif %}('{{ player.user_id }}');"
                                ></span>
                            {% endif %}
                        </td>
                        <td>{{ player.score }}</td>
                        <td>{{ player.last_update }}</td>
                        <td>{{ player.user_id }}</td>
                    </tr>
                {% endfor %}
                #}
                </tbody>
            </table>

        </div>

        <footer>&copy; <a href="https://github.com/Avasam/speedrun.com_global_scoreboard_webapp/blob/master/LICENSE" target="about">Copyright</a> {{ current_year }} by <a href="https://github.com/Avasam/" target="about">Samuel Therrien</a>.
        Powered by <a href="https://www.speedrun.com/" target="src">speedrun.com</a> and <a href="https://www.pythonanywhere.com/" target="about">PythonAnywhere</a></footer>
    </div>
</body>
</html>
